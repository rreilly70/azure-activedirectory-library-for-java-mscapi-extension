# azure-activedirectory-library-for-java-mscapi-extension


Azure Active Directory(AAD) is a great way to provide identity and access management to your applications.  Microsoft has provided the Azure Active Directory Library for Java (ADAL4J) so that AAD can be used from within java applications.  The ADAL4J provides for multiple ways for applications to authenticate against AAD.  One way is to use a username and password.  This is not the greatest for unattended authentication scenarios as you then must store the passwrord in the application or container. In many scenarios espcially with Finacial organizations the separation of esponsiblity requires limiting access to passwords sometimes even to admins and developers.  So the pasword approach can be troublesome. Another method is to use Certificates.  This can be a great way to to do unattended authentication from an application to AAD but depending on the keystore type used can also lead to other security issues.  Software keystores like JKS and JCEKS require that a password is provided when the private key is accessed.  So you are back to the same situation of having to strore a password to be able to use the key.  This can leave the keystore to be copied and used by someone not intended to have access to the AAD.  Remediations like using hardware keystore or locking down the filesytem the key lives in can be deployed.  ANother option if you are running Java from a Windows OS is to utilize the Windows Keystore.  The nice thing about this keystore is that the private key can be locked down using ACLs so that only certain users can access the key or even user groups.  THis includes users and groups managed by Active Directory.  Access to this keystore on a Windows machine is provided via the Java sunMSCAPI provider. 

The Azure Active Directory Library for Java MSCAPI project was setup to provide support for using the Microsoft Keystore on Windows from within the ADAL4J library.  The current version of ADAL4J depends on other libraries to perform the JWT token creation and signing.  These libraries currently do not support the use of the sunMSCAPI.  Ultimately those libraries and the ADAL4J should be updated to accomodate this keystore type but ADAL4J is many versions behind the current release of the Nimbus JOSE + JWT and uses classes that are now deprecated in the recent versions of this library.  Since the undertaking is more than I could handle at this moment to make updates and pull requests to the libraries I created this extension library.  It does require some extra step to be able to use it and understandably is not the best approach I wanted to provide a solution to those that may require this support. I primarily work in .NET these days but wanted the same level of keystore support for Java. This extension is basically created by copying and tweaking classes from the [ADAL4J library](https://github.com/AzureAD/azure-activedirectory-library-for-java) and [Nimbus JOSE + JWT library](http://connect2id.com/products/nimbus-jose-jwt).  So those projects should get most of the credit.

##How to use
Since this approach is kind of a hack you'll need to make sure that you pull down the source for [ADAL4J library](https://github.com/AzureAD/azure-activedirectory-library-for-java) and build it.  Like mentioned earlier I'm not a little rusty on Java and there may be a better way to do this but I found that if the ADAL4J was not compiled against the same version of Java there were issues. Also the way this library is setup is it using the same package name as ADAL4J so it looks like part of the ADAL4J and can access classes that would not be accessible if this was a separate package.  Additionally, the adal4j.jars are signed which cuases other issues for this approach.  So when you build this library build the adal4j from source at the same time and place both resulting jar in the classpath.


